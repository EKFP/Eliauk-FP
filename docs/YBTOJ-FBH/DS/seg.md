## [A. 【例题1】求区间和](http://noip.ybtoj.com.cn/contest/899/problem/1)

单修区查，直接线段树即可。

当然也可以树状数组+差分。


## [B. 【例题2】区间查改](http://noip.ybtoj.com.cn/contest/899/problem/2)

区修区查板子，当然依旧可以树状数组。


## [C. 【例题3】公园遛狗](http://noip.ybtoj.com.cn/contest/899/problem/3)

维护四个值：区间和，区间**中**最大子段和，最大**前缀和**，最大**后缀和**。

接下来我们重点考虑合并操作（即 pushup 操作）。

区间和的合并只需要将两个区间的区间和加起来即可。

**区间最大前缀和：**$\max($**左**区间的最大**前缀**和，**左**区间的**总**和+**右**区间的最大**前缀和**$)$。

???+ note "证明"
    我们考虑区间前缀和右端点的位置。

    - 如果在左区间内，那么显然取左区间最大前缀和是最优的。

    - 如果在右区间内，那么我们必然选取左区间的全部，这部分权值是定值，那么在右区间的部分选取最大前缀和也是最优的。

    证毕。

区间最大后缀和同理。

**区间中最大子段和：**

首先先选取 $\max\{$**左**区间**中**的最大**前缀**和，**右**区间**中**的最大**子段**和$\}$，这是显然的。

接下来，如果**左**区间的最大**后缀和**或**右**区间的最大**前缀和**有一个小于 $0$，那么就选取两个的最大值，否则就选取两者的和。这容易证明，证明略。

最后为两者的最大值。


## [D. 【例题4】维护序列](http://noip.ybtoj.com.cn/contest/899/problem/4)

板子题，打两个懒标记即可。


## [E. 【例题5】字符串排序](http://noip.ybtoj.com.cn/contest/899/problem/5)

定义函数 $f(x)$，表示在字母表中排名为 $x$ 的字母；$g(c)$ 表示字母 $c$ 在字母表中的排名。

由于只有 $26$ 种字符，考虑对每种字符都建立一颗线段树，这样我们需要 $26$ 颗线段树。

具体的，第 $i$ 颗线段树维护字母 $f(i)$ 区间内的出现次数。这样，根据线段树的叶子节点存储的信息可以计算每个位置的字符。

考虑排序操作，这里只讨论升序排序，因为降序排序同理即可。

我们观察一个例子：对于 `acababc` 进行排序，结果是 `aaabbcc`。这里，第 $1$ 到 $1 + 3 - 1$ 位置是 `a`，第 $4$ 到 $4 + 2 - 1$ 位置是 `b`，第 $6$ 到第 $6 + 2 - 1$ 位置是 `c`。注意到这里的 $4$、$2$、$2$ 是这些字符在区间内的个数。于是我们就有了一种方案：

每次修改时，从小往大枚举字符，这样就可以保证升序。对于字符 $i$，我们将第 $g(i)$ 颗线段树 $p + 1$ 到 $p + cnt + 1$ 修改为 $1$，其他修改为 $0$。其中，$p$ 为上一个字符的末尾，$cnt$ 为这个字符在修改的区间内的出个数。这样就可以完成的排序的操作了。

这里，我们利用了两个性质：排序后相同的字符是连续的；排序操作不影响区间内字符的个数。

输出的时候，我们遍历时遍历到叶子节点输出即可。

时间复杂度 $O(26$ $m \log(n))$。

*其实此题与[这个题](https://www.luogu.com.cn/problem/P2824)有着较为相似的思路，只不过后者将值域从 $26$ 扩大为正整数，需要二分答案，略难一些，有余力的读者可以尝试一下。*


## [F. 1.树上操作](http://noip.ybtoj.com.cn/contest/899/problem/6)

设节点 $u$ 的 DFS 序为 $dfn_u$，子树大小为 $sz_u$。

**重要结论：**

$u$ 的子树中每个节点的 DFS 序是一段连续区间，为 $[dfn_u, dfn_u + sz_u - 1]$。

证明显然，略。

那么我们就将树上的问题转为区修区查问题，线段树维护即可。



## [G. 2.取模问题](http://noip.ybtoj.com.cn/contest/899/problem/7)

维护一个区间最大值和一个区间和。取模时如果发现区间最大值小于模数就直接返回，否则暴力递归取模。由于 $x \bmod p < \frac{x}{2}, p < x$，所以这个递归取模最多取 $\log$ 次。


## [H. 3.魔法传输](http://noip.ybtoj.com.cn/contest/899/problem/8)

线段树维护差分数组，区间修改时将 $[l, r]$ 加一，$r + 1$ 减 $r - l + 1$。查询时查询区间 $[1, x]$ 即可。


## [I. 4.和或异或](http://noip.ybtoj.com.cn/contest/899/problem/9)

打一个标记，记录线段树这一层取或还是异或，然后合并（pushup）时将标记取反即可。

