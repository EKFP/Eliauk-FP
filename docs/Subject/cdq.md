## 引入

???+ note "模板"
    给定 $n$ 个三维点 $(x_i, y_i, z_i)$。$q$ 次查询，每次查询给定点 $(x_0, y_0, z_0)$，求满足 $x_0 \leq x_j, y_0 \leq y_j, z_0 \leq z_j$ 的 $j(j \neq 0)$ 的数量。

这相当于查询一个八分之一空间内点的个数。常见的做法有 CDQ 分治、树套树、KDT 等。这篇文章中主要讨论 CDQ 分治做法。

??? note "时间复杂度"
    - CDQ 分治：$(n + q)\log^2{n}$。
    - 树套树：$(n + q)\log^2{n}$。
    - KDT：$(n + q)\sqrt{n}$。

## 主要内容

我们结合一道例题来讲解 CDQ 分治的主要内容。

???+ note "[P3810](https://www.luogu.com.cn/problem/P3810)"
    给定 $n$ 个三维点 $(x_i, y_i, z_i)$。对于每个 $i$，求满足 $x_i \leq x_j, y_i \leq y_j, z_i \leq z_j$ 的 $j(j \neq i)$ 的数量。

我们已经知道二维数点的做法了，那么现在是三维数点。如果我们能想办法去掉一维，那么题目也就好做多了。

CDQ 分治给出的方法是，对第一维 $x$ 的**值域**进行分治。具体地，对于区间 $[l, r]$，把它分为 $[l, mid]$ 和 $[mid, r]$ 两个区间，其中 $mid$ 是区间 $[l, r]$ 的中点。

显然，左区间点的 $x$ 值一定小于等于右区间。这样，左区间的**所有**点都会对右区间的**询问**点产生贡献。这时，这一维已经满足偏序了，我们只需要统计剩下两维的偏序数量，这就是经典的二维数点问题。



